---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Mandy He
thanks: "Code and data are available at: https://github.com/MandyHe7/Toronto-Bids-Awarded-Contracts"
date: November 27 2024
date-format: long
abstract: "This study investigates supplier equity within Toronto’s public procurement system, focusing on the representation of small businesses and historically underrepresented sectors. Leveraging data from the Toronto Bids Awarded Contracts dataset, the analysis examines award distributions, contract values, and supplier diversity. The study aims to identify potential disparities in supplier representation and evaluate the extent to which public contracts promote equitable opportunities. Recommendations are provided to enhance supplier inclusion and foster a fairer procurement environment, emphasizing transparency, outreach, and support for underrepresented businesses."
format: pdf
number-sections: true
bibliography: references.bib
toc: true 
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(dplyr)
library(ggplot2)
library(scales)
library(lubridate)
library(knitr)
library(kableExtra)
library(broom)


# load data
Contract_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

```


# Introduction

Equitable public procurement is a cornerstone of inclusive economic development. The City of Toronto, through its competitive contracting process, allocates significant resources to suppliers for goods and services. These contracts serve as vital economic lifelines, particularly for small businesses and sectors that have traditionally been underrepresented in public procurement. However, ensuring equitable access to these opportunities remains a challenge, as systemic barriers may limit the participation of diverse suppliers.

This study explores the equity of supplier representation in Toronto’s public contracts, focusing on small businesses and underrepresented sectors. Using the Toronto Bids Awarded Contracts dataset, the research seeks to answer critical questions: Are small businesses and diverse suppliers equitably represented in contract awards? What trends emerge in terms of award amounts and supplier participation? By addressing these questions, the study aims to provide actionable insights to promote fair and inclusive procurement practices.

The research contributes to a growing discourse on supplier diversity and public accountability, underscoring the importance of fostering inclusive economic opportunities in municipal contracting. This is particularly relevant in a diverse city like Toronto, where equitable procurement practices can significantly impact local communities and drive sustainable development. Through this investigation, the study highlights current gaps and offers recommendations to strengthen supplier equity in Toronto’s public procurement system.

The remainder of this paper is structured as follows. @sec-data will discuss the data used in the study, highlighting key aspects and limitations. @sec-Results will focus on generating graphs using the data presented in @sec-data. @sec-discussion will elaborate on the graphs from @sec-Results, providing interpretations and possible explanations for the findings. 


# Data {#sec-data}

## Overview

The data used in this paper is access from Open Data Toronto and the particular data set used was the Toronto Bids Awarded Contracts [@toronto_tobids]. To analysis the data and creating graphs using the data, following package that was build in the statistical programming language R [@citeR] was used: tidyverse [@tidyverse], dplyr [@dplyr], lubridate [@lubridate], scales [@scales], knitr [@knitr], kableExtra [@kableExtra], broom[@broom] and ggplot2 [@ggplot2]. LLM [@openai2023chatgpt] was also use in term of helping with coding in R to graph data, simulating data, cleaning data, and revising writing. 

@tbl-Table1 is a preview of the clean data that will be used through out the analysis of this paper. 

```{r}
#| label: tbl-Table1
#| tbl-cap: Data Preview
#| echo: false
#| warning: false
#| message: false


# Display the table preview
kable(head(Contract_data), 
      caption = "Data Preview", 
      align = 'l', 
      col.names = c("Unique ID", "Document Number", "RFx Type", 
                    "High Level Category", "Successful Supplier", 
                    "Awarded Amount ($)", "Award Date", 
                    "Division", "Small Business"))  %>%
  kable_styling(font_size = 10) # Adjust font size 

```

## Measurement
	
To understand how a real-world phenomenon transitions into a structured dataset, it is essential to examine the lifecycle of data collection, organization, and analysis. In the case of the Toronto Bids Awarded Contracts dataset, the phenomenon begins with the City's procurement process—a critical operation where goods, services, and construction are solicited and acquired to meet public needs. This process involves multiple stages, from identifying the need for procurement, issuing requests for proposals or tenders, evaluating bids, and awarding contracts to successful suppliers. Each of these steps reflects a real-world activity that, when documented, forms the foundation for the dataset.

The transition starts with the City identifying a need, such as infrastructure development, service improvement, or administrative support. This leads to the creation of a solicitation document, outlining the scope of work, evaluation criteria, and requirements. Suppliers submit their bids, and the City evaluates them based on predefined criteria, such as cost, quality, and adherence to specifications. Once a contract is awarded, key details—including the awarded amount, supplier name, and the division requesting the procurement—are recorded.

This information is entered into the City's procurement management system, capturing the structured attributes necessary for documentation and analysis. For instance, details like the solicitation type (e.g., RFP, RFQ), high-level category (e.g., Construction Services, Professional Services), and award date are meticulously logged. To enhance the dataset's utility, additional attributes such as the division involved, buyer contact information, and a summary of the solicitation are included. The creation of a dummy variable, such as the classification of small businesses, involves further data processing to derive new insights from raw attributes like the awarded amount.

Ultimately, the dataset represents a structured snapshot of a complex real-world process. Each entry reflects decisions, negotiations, and activities that unfolded in the real world, carefully abstracted into numerical and categorical variables. This process of translation allows researchers, policymakers, and the public to analyze the data to uncover patterns, monitor equity, and assess the efficiency and fairness of the City's procurement system. The dataset, while detailed, is always an abstraction—capturing key facets of the phenomenon while omitting others deemed less relevant to the analysis.

## Data Variables

The dataset includes information on competitive procurement processes and awarded contracts by the City of Toronto. Key variables are:

- Unique Row Identifier (_id): A unique identifier for each record in the Open Data database.

- Composite Key (unique_id): A unique identifier combining related procurement details.

- Document Number: A reference number used by the City to track the solicitation during the procurement process.

- RFx Type (Solicitation Type): The procurement method used for the solicitation, such as Request for Proposal (RFP), Request for Quotation (RFQ), Tender (RFT), and others. This indicates the process used to seek bids or proposals from suppliers.

- High-Level Category: Groups the goods or services being procured, such as Goods and Services, Professional Services, or Construction Services.

- Successful Supplier: The name of the supplier awarded the contract.

- Awarded Amount: The total monetary value awarded to the supplier for the contract.

- Award Date: The date the contract between the City and the supplier was finalized.

- Division: The City Division requesting the procurement. The awarded supplier will have a contract with this division.

- Buyer Details: Includes the buyer's name, email, and phone number as the primary purchasing contact for the solicitation or contract.

- Solicitation Document Description: A summary of the solicitation, providing additional context about the procurement request.

In addition, there was a small business classification was created for its role in the analysis.

- Small Business (Dummy Variable): A binary variable indicating whether a supplier qualifies as a small business. Businesses are classified as small (TRUE), while others are classified as large (FALSE) determine by ChatGPT analysis, refer to [Appendix -@sec-appdata] for more detail.




# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.



# Results

The pie chart @fig-PieChart demonstrates majority of contracts awarded to small businesses (marked as TRUE for small business). This indicates that small businesses have relative representation in the awarding process, suggesting equity just by looking at proportion.
```{r}
#| label: fig-PieChart
#| fig-cap: Proportion of Small Business Awards
#| echo: false
#| warning: false
#| message: false

# Pie chart: Proportion of Small Business Awards
small_business_summary <- Contract_data %>%
  group_by(Small_Business) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE))

ggplot(small_business_summary, aes(x = "", y = Total_Awarded, fill = Small_Business)) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  coord_polar(theta = "y") +
  labs(title = "Proportion of Small Business Awards",
       x = NULL,
       y = NULL) +
  theme_void()

```

\newpage
This bar chart @fig-bargraph displays the total awarded amount ($) for different RFx (Request for X) types. Key observations:

RFT (Request for Tender) has the highest awarded amount, exceeding $1.2 billion, suggesting that most of the procurement budget is funneled through tenders.
RFQ (Request for Quotation) and RFP (Request for Proposal) follow, with awarded amounts slightly below $500 million and around $400 million, respectively.
Other RFx types (e.g., NRFP, OTP, RFSQ) have minimal awarded amounts, indicating limited use in contract awards.
```{r}
#| label: fig-bargraph 
#| fig-cap: Bar graph 
#| echo: false
#| warning: false
#| message: false

# Summarize awarded amounts by RFx Type
rfx_summary <- Contract_data %>%
  group_by(RFx_Type) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE)) %>%
  arrange(desc(Total_Awarded))

# Bar plot: Total Awarded Amount by RFx Type
ggplot(rfx_summary, aes(x = RFx_Type, y = Total_Awarded, fill = RFx_Type)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  scale_y_continuous(labels = dollar_format()) +
  labs(title = "Total Awarded Amount by RFx Type",
       x = "RFx Type",
       y = "Total Awarded Amount ($)") +
  theme_minimal()
```


\newpage
This stacked bar chart @@fig-bar2 breaks down supplier classification (Small Business vs. Large Business) for each RFx type:

Small Businesses (TRUE) dominate RFQ, RFP, and RFSQ types, showing significant representation in these categories.
Large Businesses (FALSE) appear to win the majority of contracts in RFT, reflecting a potential preference for larger suppliers in high-value tenders.
NRFP and OTP show exclusive or near-exclusive awards to Large Businesses, albeit with lower overall amounts.

```{r}
#| label: fig-bar2
#| fig-cap: Awarded Amounts Over Time
#| echo: false
#| warning: false
#| message: false

# Calculate proportions of Small and Large Businesses by RFx Type
rfx_small_large <- Contract_data %>%
  group_by(RFx_Type, Small_Business) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE)) %>%
  mutate(Proportion = Total_Awarded / sum(Total_Awarded)) %>%
  ungroup()

# Bar Plot: Proportion of Small vs. Large Businesses by RFx Type
ggplot(rfx_small_large, aes(x = RFx_Type, y = Proportion, fill = Small_Business)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Proportion of Small vs. Large Businesses by RFx Type",
       x = "RFx Type",
       y = "Proportion",
       fill = "Small Business") +
  theme_minimal()

```





Looking at @fig-Boxplot, categories like "Construction Services" and "Professional Services" show a wide range of awarded amounts, with some outliers receiving significantly higher awards. Smaller categories (e.g., "Offer to Purchase") have fewer instances and seem to award comparatively smaller amounts. This indicates potential concentration of funding in certain categories, which may not benefit small businesses.
```{r}
#| label: fig-Boxplot
#| fig-cap: Awarded Amounts by High-Level Category
#| echo: false
#| warning: false
#| message: false

# Box plot: Awarded Amounts by High-Level Category
ggplot(Contract_data, aes(x = High_Level_Category, y = Awarded_Amount, fill = High_Level_Category)) +
  geom_boxplot(show.legend = FALSE) +
  scale_y_continuous(labels = dollar_format()) +
  labs(title = "Distribution of Awarded Amounts by Category",
       x = "Category",
       y = "Awarded Amount ($)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

@fig-bar1, Across most categories, the representation of small businesses is minimal compared to large businesses.Notably, in the "Offer to Purchase" category, there seems to be equal representation of small and large businesses. This could imply specific policies or practices in that category that favor small businesses.

```{r}
#| label: fig-bar1
#| fig-cap: Awarded Amounts Over Time
#| echo: false
#| warning: false
#| message: false


# Calculate proportions of Small and Large Businesses by High-Level Category
category_small_large <- Contract_data %>%
  group_by(High_Level_Category, Small_Business) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE)) %>%
  mutate(Proportion = Total_Awarded / sum(Total_Awarded)) %>%
  ungroup()

# Bar Plot: Proportion of Small vs. Large Businesses by High-Level Category
ggplot(category_small_large, aes(x = High_Level_Category, y = Proportion, fill = Small_Business)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(title = "Proportion of Small vs. Large Businesses by High-Level Category",
       x = "High-Level Category",
       y = "Proportion",
       fill = "Small Business") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```


Looking at @fig-Timeseries, large businesses consistently receive significantly higher awarded amounts compared to small businesses. The awarded amounts to small businesses remain relatively stable over time, showing minimal fluctuation. This highlights the dominance of large businesses in the procurement process.
```{r}
#| label: fig-Timeseries
#| fig-cap: Awarded Amounts Over Time
#| echo: false
#| warning: false
#| message: false

# Load necessary libraries
library(ggplot2)
library(dplyr)
library(lubridate)


# Summarize awarded amounts by month and business type
time_series_data <- Contract_data %>%
  mutate(Month = floor_date(Award_Date, "month")) %>%
  group_by(Month, Small_Business) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE)) %>%
  ungroup()

# Plot the time series
ggplot(time_series_data, aes(x = Month, y = Total_Awarded, color = Small_Business)) +
  geom_line(size = 1.2) +
  labs(title = "Awarded Amount to Small vs. Large Businesses Over Time",
       x = "Time (Monthly)",
       y = "Total Awarded Amount ($)",
       color = "Business Type") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

@fig-TimeseriesSmall, the scatterplot shows awarded amounts to small businesses distributed across time, with no clear upward or downward trend. The shaded confidence interval around the regression line suggests high uncertainty in predicting changes over time. Overall, there is no strong evidence of growth or decline in the awarded amounts to small businesses.
```{r}

#| label: fig-TimeseriesSmall
#| fig-cap: Awarded Amounts Over Time
#| echo: false
#| warning: false
#| message: false

small_business_data <- Contract_data %>% 
  filter(Small_Business == TRUE) %>% 
  mutate(Month = floor_date(Award_Date, "month"))

# Aggregate awarded amounts by month for small businesses
regression_data <- small_business_data %>%
  group_by(Month) %>%
  summarise(Total_Awarded = sum(Awarded_Amount, na.rm = TRUE)) %>%
  ungroup()

# Add a numeric time variable for regression
regression_data$Time <- as.numeric(regression_data$Month)

# Fit a linear regression model
model <- lm(Total_Awarded ~ Time, data = regression_data)
summary(model)

# Plot the results
ggplot(regression_data, aes(x = Month, y = Total_Awarded)) +
  geom_point(color = "blue", size = 2) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "Regression Analysis: Awarded Amount to Small Businesses Over Time",
       x = "Time (Monthly)",
       y = "Total Awarded Amount ($)") +
  theme_minimal() +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```






A logistic regression model can help assess the factors influencing whether a contract is awarded to a small business.

In regression result @tbl-Table2, coefficients indicate how the likelihood of a contract being awarded to a small business changes with variables like Awarded_Amount, RFx_Type, and High_Level_Category.
Significant p-values for predictors suggest they have an impact on the outcome.

```{r}
#| label: tbl-Table2
#| tbl-cap: Logistic regression model
#| echo: false
#| warning: false
#| message: false

# Logistic regression model
log_model <- glm(Small_Business ~ RFx_Type + High_Level_Category + Awarded_Amount, 
                 data = Contract_data, family = binomial)

summary(log_model)
# Tidy the model output for a table
log_model_summary <- broom::tidy(log_model)

# Add odds ratios (exponentiated coefficients) and confidence intervals
log_model_summary <- log_model_summary %>%
  mutate(Odds_Ratio = exp(estimate)) %>%
  mutate(Lower_CI = exp(estimate - 1.96 * std.error),
         Upper_CI = exp(estimate + 1.96 * std.error))

# Display the table
log_model_summary %>%
  select(term, estimate, std.error, Odds_Ratio, Lower_CI, Upper_CI, p.value) %>%
  kable(
    caption = "Logistic Regression Results: Predicting Small Business Contracts",
    col.names = c("Term", "Estimate (Log Odds)", "Std. Error", 
                  "Odds Ratio", "Lower CI", "Upper CI", "P-Value"),
    digits = 4, align = "c"
  ) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))


```


# Discussion

## Equitable Representation Across RFx Types {#sec-first-point}

The analysis of supplier representation across different RFx types highlights important trends and disparities in Toronto's public procurement system. Small businesses are well-represented in RFQ (Request for Quotation), RFP (Request for Proposal), and RFSQ (Request for Supplier Qualification) processes, suggesting that these procurement methods are more accessible due to potentially lower barriers to entry or more flexible requirements. However, large businesses dominate RFT (Request for Tender) contracts, which account for the majority of procurement spending, exceeding $1.2 billion. This imbalance points to structural challenges for small businesses, as RFT contracts often involve stringent qualification criteria or large-scale projects that may favor larger, more established firms. The limited representation of small businesses in RFTs underscores the need for more equitable procurement practices, particularly in high-value tenders.

To address these disparities, targeted policy interventions are necessary. Simplifying bidding requirements for RFT contracts and creating set-aside opportunities for small businesses could help level the playing field. Additionally, encouraging large firms to subcontract with smaller enterprises can foster more inclusive participation. These measures, coupled with enhanced outreach and support programs, can ensure that Toronto’s procurement processes better reflect the principles of equity and inclusivity, offering fair opportunities to businesses of all sizes while optimizing the diversity of its supplier base.

The analysis reveals that small businesses are well-represented in RFQ (Request for Quotation), RFP (Request for Proposal), and RFSQ (Request for Supplier Qualification) processes, suggesting these procurement types may be more accessible due to lower thresholds or flexible requirements. However, the dominance of large businesses in RFT (Request for Tender) contracts raises equity concerns, as these tenders account for the highest awarded amounts and may limit opportunities for smaller firms. The disparity highlights structural barriers, such as stringent qualification criteria or large-scale project scopes, that could disadvantage small businesses in accessing RFT opportunities. This imbalance underscores the need to reevaluate procurement processes to ensure fair access across all RFx types. Exploring RFT qualification criteria could uncover areas for policy adjustments to enhance inclusivity. Simplifying bidding requirements, introducing targeted outreach programs, and setting aside a portion of high-value tenders for small businesses are actionable strategies to address these challenges. Additionally, encouraging large firms to subcontract with smaller suppliers could further foster equitable participation. By implementing these measures, Toronto’s procurement system can better balance supplier representation, ensuring that public contracts promote equity, inclusion, and diverse economic growth.


##  {#sec-second-point}


##  {#sec-thrid-point}



## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Details on Selection of Big Business Out From Data {#sec-appdata}

The reult of selection of big business is by using ChatGPT.

I asked: 
in the data, under the Successful_Supplier, can you anaysis and pull out the excat names that are consider as big business and put them into a big_business_list, so i can use it for r code
ChatGPT said:
ChatGPT
The dataset contains the following columns:

unique_id: A unique identifier for each record.
Document_Number: The associated document number.
RFx_Type: Type of request (e.g., RFQ, RFP).
High_Level_Category: The category of the procurement.
Successful_Supplier: The name of the supplier who won the contract.
Awarded_Amount: The monetary value of the awarded contract.
Award_Date: The date the contract was awarded.
Division: The division responsible for the contract.
Small_Business: Indicates if the supplier is classified as a small business (True/False).
To identify big businesses, I will filter out suppliers where Small_Business is False and create a list of their names.

The following are the big businesses identified from the dataset:

Guillevin International Co.
Sysco
Sysco Toronto, A Division Of Sysco Canada Inc.
Stantec Consulting Ltd
KPMG LLP
KPMG
Bennett Mechanical Installations
Fer-Pal Construction Ltd.
WSP Canada Inc
Black And McDonald Limited
Thermo Fisher Scientific
Sutherland-Schultz Ltd.
Morrison Hershfield Ltd
Morrison Hershfield
Metro Freightliner Hamilton Inc
Ricoh Canada Inc
Altus Group Limited
Kroll Consulting Canada Co.
Suncorp Valuations
Logixx Security Inc
Garda Canada Security Corporation
Drake International Inc
Bevertec CST Inc
AECOM Canada Ltd
Stericycle Ulc
Schindler Elevator Corporation
Graham Bros. Construction Limited
Morrison Hershfield Limited
Softchoice LP
Damen Shipbuilding 5 B.V.
Graham Bros Construction Ltd.
Gartner Canada
Parsons Inc
Jacobs Consultancy Canada Inc
Stericycle, Ulc

This list is now ready for use in your R code. Let me know if you need it in a specific format! 

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 


## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...



\newpage


# References


